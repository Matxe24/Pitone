<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Pitone Web IDE</title>
  <style>
    body {
      background-color: #0f0f0f;
      color: #f0f0f0;
      font-family: 'Fira Code', monospace;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #1f1f1f;
      padding: 1em;
      text-align: center;
      font-size: 1.2em;
      color: #00ff88;
      border-bottom: 2px solid #00ff88;
    }
    #editor {
      width: 90%;
      height: 200px;
      margin: 2em auto;
      background-color: #1a1a1a;
      color: #fff;
      border: 1px solid #444;
      padding: 1em;
      resize: vertical;
    }
    #output {
      width: 90%;
      margin: 1em auto;
      background-color: #111;
      color: #0f0;
      border: 1px solid #333;
      padding: 1em;
      min-height: 100px;
      white-space: pre-wrap;
    }
    button {
      background-color: #00ff88;
      color: #000;
      border: none;
      padding: 0.5em 1em;
      margin: 0.5em;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background-color: #00cc66;
    }
    footer {
      text-align: center;
      font-size: 0.8em;
      color: #666;
      margin-top: 2em;
    }
  </style>
</head>
<body>
  <header>
    üêç Pitone Web IDE v1.0 ‚Äì Made by Flawx
  </header>

  <textarea id="editor" placeholder="scrivi &quot;Ciao mondo&quot;   ripeti 3 volte    scrivi &quot;ripetizione&quot; fine"></textarea>
  <div style="text-align: center;">
<!--  <button onclick="compila()">Compile</button> -->
    <button onclick="avvia()">Start</button>
    <button onclick="resetta()">Reset</button>
  </div>
  <div id="output">üí° Output will appeare here...</div>

  <footer>
    ¬© 2025 Pitone Project ‚Äì Fo3under: Flawx | Discord: https://dsc.gg/pitone | Github: https://github.com/Matxe24/Pitone | Donations are avaible in Discord. Thanks for the support!
  </footer>

  <script>
    let codiceJS = "";
    const dichiarate = new Set(); // traccia le variabili dichiarate

    function wrapStringIfNeeded(s) {
      s = s.trim();
      if (/^["'`].*["'`]$/.test(s)) return s; // gi√† tra virgolette
      return JSON.stringify(s); // wrappa come stringa JS
    }

    function compila() {
      const input = document.getElementById("editor").value;
      const righe = input.split("\n");
      let out = [];
      let indent = 0;

      function indenta() {
        return "  ".repeat(indent);
      }

      for (let raw of righe) {
        let riga = raw.trim();
        if (riga.length === 0) { out.push(""); continue; }

        // scrivi ...
        if (riga.startsWith("scrivi ")) {
          const contenuto = riga.slice(7).trim();
          out.push(indenta() + `console.log(${contenuto});`);
          continue;
        }

        // chiedi "Domanda" ‚Üí variabile
        if (riga.includes("chiedi") && riga.includes("‚Üí")) {
          let [sx, dx] = riga.split("‚Üí");
          let domanda = sx.split("chiedi")[1].trim();
          domanda = wrapStringIfNeeded(domanda);
          let variabile = dx.trim();
          if (!dichiarate.has(variabile)) {
            dichiarate.add(variabile);
            out.push(indenta() + `var ${variabile} = prompt(${domanda});`);
          } else {
            out.push(indenta() + `${variabile} = prompt(${domanda});`);
          }
          continue;
        }

        // variabile = chiedi "Domanda"
        if (riga.includes("=") && riga.includes("chiedi")) {
          let [lhs, rhs] = riga.split("=");
          let variabile = lhs.trim();
          let domanda = rhs.split("chiedi")[1].trim();
          domanda = wrapStringIfNeeded(domanda);
          if (!dichiarate.has(variabile)) {
            dichiarate.add(variabile);
            out.push(indenta() + `var ${variabile} = prompt(${domanda});`);
          } else {
            out.push(indenta() + `${variabile} = prompt(${domanda});`);
          }
          continue;
        }

        // assegnazioni generiche: x = espressione
        if (riga.includes("=") && !riga.includes("‚Üí")) {
          let [lhs, rhs] = riga.split("=");
          let variabile = lhs.trim();
          let expr = rhs.trim();
          if (!dichiarate.has(variabile)) {
            dichiarate.add(variabile);
            out.push(indenta() + `var ${variabile} = ${expr};`);
          } else {
            out.push(indenta() + `${variabile} = ${expr};`);
          }
          continue;
        }

        // se ... allora
        if (riga.startsWith("se ") && riga.includes("allora")) {
          const condizione = riga.slice(3).split("allora")[0].trim();
          out.push(indenta() + `if (${condizione}) {`);
          indent++;
          continue;
        }

        // altrimenti
        if (riga === "altrimenti") {
          indent--;
          out.push(indenta() + `} else {`);
          indent++;
          continue;
        }

        // fine
        if (riga === "fine") {
          indent = Math.max(indent - 1, 0);
          out.push(indenta() + `}`);
          continue;
        }

        // ripeti N volte
        if (riga.startsWith("ripeti ") && riga.includes("volte")) {
          const numero = riga.slice(7).split("volte")[0].trim();
          out.push(indenta() + `for (let i = 0; i < ${numero}; i++) {`);
          indent++;
          continue;
        }

        // mentre condizione
        if (riga.startsWith("mentre ")) {
          const condizione = riga.slice(7).trim();
          out.push(indenta() + `while (${condizione}) {`);
          indent++;
          continue;
        }

        // def nome  -> function nome()
        if (riga.startsWith("def ")) {
          const nome = riga.slice(4).trim();
          out.push(indenta() + `function ${nome} {`);
          indent++;
          continue;
        }

        // ritorna valore
        if (riga.startsWith("ritorna ")) {
          const valore = riga.slice(8).trim();
          out.push(indenta() + `return ${valore};`);
          continue;
        }

        // commenti
        if (riga.startsWith("#") || riga.startsWith("commento")) {
          out.push(indenta() + `// ${riga}`);
          continue;
        }

        // inizio
        if (riga === "inizio") {
          out.push(indenta() + `// Inizio programma Pitone`);
          continue;
        }

        // chiamate tipo funzione() o espressioni con parentesi
        if (riga.includes("(") && riga.includes(")")) {
          out.push(indenta() + `${riga};`);
          continue;
        }

        // fallback
        out.push(indenta() + `// Unkown command: ${riga}`);
      }

      codiceJS = out.join("\n");
      document.getElementById("output").textContent = codiceJS;
    }

    function avvia() {
      compila();
      try {
        const logs = [];
        const originalLog = console.log;
        console.log = function (...args) {
          logs.push(args.map(a => String(a)).join(" "));
        };
        // Esegui in un wrapper per evitare collisioni con lo scope globale
        new Function(codiceJS)();
        console.log = originalLog;
        document.getElementById("output").textContent = logs.join("\n") || "‚úÖ Code executed perfectly without output";
      } catch (err) {
        document.getElementById("output").textContent = "‚ùå Error:\n" + err;
      }
    }

    function resetta() {
      document.getElementById("editor").value = "";
      document.getElementById("output").textContent = "üí° Output will appeare here";
      dichiarate.clear();
      codiceJS = "";
    }
  </script>
</body>
</html>
